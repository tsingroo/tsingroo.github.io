---
author: tsingroo
date: 2016-08-31 10:00:50+08:00
layout: post
title: '[整理]数据库需要外键约束吗'
---
用数据库这么多年，一直没考虑数据库约束的问题。今天在学习django框架时候想了一下。遂从网上搜集了一些观点，去除重复的回答并纠正了一些错别字错误。大部分整理自Iteye和知乎。里面不乏有知名大神的回复

 ### [问题](http://www.iteye.com/problems/91638): 最近做项目的时候在讨论表与表之间的关系是否需要建立外键约束，下面是我总结的一些优缺点，欢迎大家指导，帮忙分析一下到底使用哪种方式

##### 建立外键的好处：
 1. 由数据库保证数据完整性，比程序保证完整性更可靠，
多应用时（如有应用A,B,C他们之间的实体存在关联关系），由程序来保证数据完整性变得困难
 2. 外键约束使得数据库的ER图可读性变强，有助于业务逻辑设计

##### 不建立外键的好处：
 1. 可以用触发器或应用程序保证数据的完整性
 2. 开发变得简单，维护数据时不用考虑外键约束
 3. 性能高，大数据量插入操作时不用考虑维护外键
讨论结果：不建立外键约束，关联关系由程序控制，另外还需要删除现有的外键关系

### 下面是各方的回复
***mqlfly2008:***
从面向对象设计的角度来看。是应该取消掉外键约束的。因为数据库的作用就是高校的存取数据。而不是表达业务逻辑关系。把业务逻辑关系放到数据库中来维护是一种非常面向过程的思维。使得程序设计，用例规则直接面向数据库而不是面向业务。怎么看都不是一种好的方式

***JasonWo:***
外键还是有必要的，如果项目是基于数据驱动的，保证数据的完整有效性，尤为重要。但如果外键过于复杂出现嵌套类似现象对于编程来说也是比较痛苦，所以建议简单的外键约束。

***zqb666kkk:***
如果 用hibernate框架的 如果实体类用hibernate自动创建的那种 你会发现如果用了外键约束 会更新 不了数据
其实没有必要用外键约束 ，这些逻辑可言通过程序控制的
主要就是 用了外键约束在某些框架下会给你程序开发带来不必要的 麻烦，
如果你不用hibernate这种框架的话 我觉得 用外键约束还是可以的 可以保证你数据的  合理性 避免因为你程序的漏洞而导致的数据冗余

***jiangnan2112:***
个人觉得还是需要的。理由如下：1. 一般情况数据是最重要的，离开了数据，程序系统本身什么也不是，所以数据本身完整性更好。2、数据全部由程序维护，程序万一不用了,down掉了，程序人员全换了，升级了等，谁也不能保证后续人马能跟以前人马一样懂，这时候如果有个完整的数据，关系也清楚，更能省事点。3、程序维护数据容易出现程序bug导致数据有错误。什么都可以不对，但数据一定要对，要是我银行卡余额多了8个0，那敢情好了。

***diaozhanming:***
我与上边几位有些不同的观点，我觉得这和你项目使用的orm框架和业务复杂程度有关，如果使用的是hibernate这样的框架而且本身的业务不复杂，还是尽可能的在数据库中建立好关系，这样在编码以及理解业务的时候，会比较方便，如果系统是维护或者遗留项目，而且业务逻辑复杂，最好利用程序维护关系

***李楠:***
因为很多答案对但是不精到，我再回答一个。
这实际上不是个数据库问题，而是个架构问题。
使用外键与否，看你使用的框架是否有足够的事务管理能力。
（其实不仅限于外键，还有一切可被替代的 db 高级特性）
如果足够，那么应该尽量避免。
理由很简单：app server 比 db server 便宜，而且拓展容易。

***响马:***
数据库的诸多设计，帐号，权限，约束，触发器，都是为 C/S 结构设计的，是以 C 端不可信做为假设前提的。B/S 模式安全边界前移到 web 服务层，应用与数据库之间是可信的，应用自行完成这些功能更加灵活。
所以能不用就不用。

***Fenng:***
怎么总有人问我数据库的问题...
透露一个秘密，我在前公司的时候摘掉了所有的外键。业务约束通过中间层控制。面向Web的应用应该这样。
一个DBA是否有足够的设计能力，就看他有多大的能力做反范式设计就可以了。不要问为什么。

***mysqlops:***
先评论下各位专家回答的内容：

 @feng:一个DBA是否有足够的设计能力，就靠他有多大的能力做反范式设计就可以了
--- 这句话有点过于放大，以及跟作者说的题目无半毛钱的关系，是否使用外键跟范式无任何关系

@西祠响马 --- 说的内容是有道理的

@光芊源 --- 提到性能

从上到下太多人提到范式，甚至强调反范式 ---- 你们懂范式嘛？ 范式跟外键的设计有关系吗？
别不懂装懂了，各位专家，误人子弟就不好！大家若不懂范式，建议看下 萨老和王美女主编的书籍<<数据库系统概论>>

回答下问题：
外键是否采用看业务应用场景，以及开发成本的，大致列下什么时候适合，什么时候不适合使用：
 1. 互联网行业应用不推荐使用外键： 用户量大，并发度高，为此数据库服务器很容易成为性能瓶颈，尤其受IO能力限制，且不能轻易地水平扩展；若是把数据一致性的控制放到事务中，也即让应用服务器承担此部分的压力，而引用服务器一般都是可以做到轻松地水平的伸缩；

 2. 传统行业
1>.软件应用的人数有限，换句话说是可控的；
2>.数据库服务器的数据量也一般不会超大，且活跃数据有限；

综合上述2句话描述，也即数据库服务器的性能不是问题，所以不用过多考虑性能的问题；另外，使用外键可以降低开发成本，借助数据库产品自身的触发器可以实现表与关联表之间的数据一致性和更新；最后一点，使用外键的方式，还可以做到开发人员和数据库设计人员的分工，可以为程序员承担更多的工作量；

为何说外键有性能问题：
1.数据库需要维护外键的内部管理；
2.外键等于把数据的一致性事务实现，全部交给数据库服务器完成；
3.有了外键，当做一些涉及外键字段的增，删，更新操作之后，需要触发相关操作去检查，而不得不消耗资源；
4.外键还会因为需要请求对其他表内部加锁而容易出现死锁情况；

***鲁塔弗:***
外键在早期企业系统数据库设计里面比较多吧，本意是好了，帮程序员节省delete,update操作，实际上增加了潜规则，也增加了软件复杂度。互联网应用中，一般流量比较大，数据库当memecache用，大表+冗余字段，索引还建在外部用sphinx之类，基本上没有表和表的关联关系，外键无用

***匿名用户:***
我比较愚昧：约束放到应用层里面，假如你们公司的客户想多配置几台服务器（可能是服务器硬件差，带不了所有的客户端），这时就意味有几个应用层同时在运行的，这种情况下如何使得约束能按照设计正确工作。配置多台服务器的情况很常见，倒是动不动就用什么SQL集郡的好。我没见
